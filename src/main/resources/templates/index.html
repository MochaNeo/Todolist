<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>TodoList</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"rel="stylesheet">
</head>

<body>
	
	
    <h2 class="display-4 mb-4">Todo app</h2>
    
    <a th:unless="${todoItemForm.done}" th:href="@{/?isDone=true}">完了したアイテムの表示</a>
    <a th:if="${todoItemForm.done}" th:href="@{/?isDone=false}">TODOの表示</a>
    
    <h3>TODOの追加</h3>
		<form method="post" th:action="@{/new}">
    		<a>カテゴリー<a/>
    			<select name="category">
        			<option value="work">仕事</option>
        			<option value="private">趣味・私生活</option>
    	    		<option value="other">その他</option>
    			</select>
    		<p></p>
    		
    		<a>タイトル</a>
    			<input type="text" name="title" />
    		<p></p>
    		
    		<a>詳細</a>
    			<input type="text" name="description" />
    		<p></p>
    		
    		<a>優先度</a>
    			<select name="priority">
        			<option value="1">低</option>
        			<option value="2">中</option>
        			<option value="3">高</option>
    			</select>
    			
    		<a>期日</a>
				<input type="date" id="dueDate" name="dueDate" />
			<p></p>

			<script>
				// 今日の日付を取得
				var today = new Date();

				// 年、月、日を取得
				var year = today.getFullYear();
				var month = (today.getMonth() + 1).toString().padStart(2, '0'); // 月は0から始まるため+1が必要
				var day = today.getDate().toString().padStart(2, '0');

				// "YYYY-MM-DD" 形式の日付文字列を作成
				var formattedDate = year + '-' + month + '-' + day;

				// input要素にデフォルト値として設定
				document.getElementById('dueDate').value = formattedDate;
			</script>

    		
    		<input type="submit" value="追加" />
		</form>
		<p></p>
    	
    <div th:if="${todoItemForm.errorMessage}" th:text="${todoItemForm.errorMessage}" class="error-message"></div>
    <p></p>
    
    
    <h3>TODOリスト</h3>
    <table class="table table-hover">
        <thead>
            <tr>
				<th>カテゴリー</th>
                <th>タイトル</th>
                <th>詳細</th>
                <th>優先度</th>
                <th>作成日</th>
                <th>期日</th>
                <th>完了・未完了</th>
                <th>削除</th>
            </tr>
        </thead>
        
        <tbody>
            <tr th:each="todoItem : ${todoItemForm.todoItems}">
				
				<td>
					<span th:switch="${todoItem.category}">
						<span th:case="work">仕事</span>
						<span th:case="private">趣味・私生活</span>
						<span th:case="other">その他</span>
					</span>
				</td>
				
                <td th:text="${todoItem.title}"></td>
                <td th:text="${todoItem.description}"></td>
                
                <td>
					<span th:switch="${todoItem.priority}">
						<span th:case="1">低</span>
						<span th:case="2">中</span>
						<span th:case="3">高</span>
						<span th:case="*">未設定</span>
					</span>
				</td>
				
				<td th:text="${todoItem.createDate}"></td>
				
				<td th:text="${todoItem.dueDate}"></td>
				
                <td>
                    <form th:unless="${todoItemForm.done}" method="post" th:action="@{/done}" th:object="${todoItem}">
                        <input type="hidden" name="id" th:value="*{id}" />
                        <input type="submit" value="Done" />
                    </form>
                    <form th:if="${todoItemForm.done}" method="post" th:action="@{/restore}" th:object="${todoItem}">
                        <input type="hidden" name="id" th:value="*{id}" />
                        <input type="submit" value="Restore" />
                    </form>
                </td>
                <td>
					<form method="post" th:action="@{/delete}" th:object="${todoItem}">
        				<input type="hidden" name="id" th:value="*{id}" />
        				<input type="submit" value="Delete" />
    				</form>
				</td>
            </tr>
        </tbody>
    </table>
</body>
</html>